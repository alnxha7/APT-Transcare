{% extends "base.html" %}
{% load static %}
{% block content %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorry Receipt</title>

    <link href="{% static 'css/font-face.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/font-awesome-5/css/fontawesome-all.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="{% static 'vendor/bootstrap-4.1/bootstrap.min.css' %}" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="{% static 'vendor/animsition/animsition.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css' %}" rel="stylesheet"
          media="all">
    <link href="{% static 'vendor/wow/animate.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/css-hamburgers/hamburgers.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/slick/slick.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/select2/select2.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.css' %}" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="{% static 'css/theme.css' %}" rel="stylesheet" media="all">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
    @media print {
        body {
            width: 210mm;
            height: 297mm;
            margin: 0;
            padding: 0;
        }
        table {
            width: 100%;
        }
        #print-button {
            display: none;
        }
    }
        .form-control {
        padding: 0px 8px;
        font-size: 14px;
    }
    .mb-3, .mb-2 {
        margin-bottom: 8px !important;
        align-items: center;
    }
     body {
            font-family: Public Sans, sans-serif;
            background-color: #f4f4f4;

            margin: 0;
            padding: 0;
            font-size: 14px;
            align-items: center;
            color:black;
            overflow-x: hidden;

        }
         .logo p {
        color:white;
        }
        .container_box {
            background-color:antiquewhite;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border: 2px solid rgb(43, 114, 227);
            margin-left:20px;
            margin-top: 25px;
        }


        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            padding-top: 7px;
            margin-bottom: 5px;
        }

        
        input, select {
            width: 100%;
            font-size: 10px;
        }
        select {
        background:white;
        

        }
        table {
            background:white;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom:20px;
        }
        .table_input{
            border:none;
        }
        th {
            border: 1px solid black;
            background:#f2f2f2;
            padding:0px;
            text-align: center;
            font-size: 12px;
        }
        button {
            padding: 10px;
            background: #28a745;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #218838;
        }
        .btn {
            margin-top: -10px;
            display: inline-block;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 4px;
            color: white;
            margin-right:10px;
            margin-bottom:20px;
        }

        .btn-info{
            margin-top: -25px;
            display: inline-block;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 4px;
            color: white;
            margin-right:10px;
            margin-bottom:-15px; 
        }

        .save-btn { background-color: #28a745; }
        .back-btn { background-color: #007bff; }

        .input-right {
            text-align: right;
        }
    @media only screen and (max-width: 600px) {
  .container_box  {
    width: 90%;
  }
}
    label {
        font-weight: 500;
        width: 90px;
        font-size: 12px;
    }
    .form-group-row {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }
    .form-group-row label {
        min-width: 120px;
        margin-right: 8px;
        margin-bottom: 0;
    }
    /* .table-container {
            margin-top: 20px;
            overflow-x: auto;
        } */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th {
            border: 1px solid #999;
            padding: 0px;
            text-align: center;
        }
        td {
            border: 1px solid #999;
            padding: -4px;
            text-align: center;
            font-size: 11px;
        }
        th {
            background-color: #f2f2f2;
        }
        input[type="text"], input[type="number"] {
            /* width: 100%; */
            padding: -5px;
            box-sizing: border-box;
        }
        .btn-delete {
            color: white;
            border: none;
            padding: 0px 5px;
            cursor: pointer;
        }
        .btn-delete:hover {
            background-color: #c0392b;
        }
        .table_data {
            font-size: 12px;
            padding: 2px 4px;
            text-align: center;
            width: 70px; /* set a fixed width */
            max-width: 80px; /* prevent stretching */
            box-sizing: border-box;
        }
.top-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 25px;
}

/* Column styling */
.column {
    flex: 1;
    min-width: 300px;
}

.column h4 {
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 10px;
    text-decoration: underline;
}

/* Single field row */
.form-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
    width: 100%;
    gap: 8px;
}

.form-row label {
    flex: 0 0 68px;
    text-align: left;
    font-size: 13px;
    margin: 0;
    white-space: nowrap;
}

.form-row input,
.form-row select {
    flex: 1;
    padding: 2px 3px;
    font-size: 13px;
    border: 1px solid #ccc;
}

/* Double fields (2 per row) */
.form-row.double {
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.field-pair {
    display: flex;
    align-items: center;
    flex: 1;
    gap: 6px;
}

.field-pair label {
    flex: 0 0 3px;
    text-align: left;
    font-size: 13px;
}

.field-pair input,
.field-pair select {
    flex: 1.5;
}

/* Bottom OK button */
.bottom-buttons {
    width: 100%;
    text-align: center;
    margin-top: 12px;
}

.bottom-buttons button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 6px 14px;
    font-size: 13px;
    border-radius: 4px;
    cursor: pointer;
}

.bottom-buttons button:hover {
    background-color: #0056b3;
}

/* Responsive */
@media (max-width: 992px) {
    .top-section {
        flex-direction: column;
    }
}

.form-group {
    margin: 0px;
}

    .bottom-section {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.column {
    padding: 2px;
    border-radius: 6px;
   /* box-shadow: 0 0 4px rgba(0, 0, 0, 0.1);*/
}

/* Widths to control layout */
/* .first-column {
    flex: 1; 
} */

.second-column {
    flex: 0.5; /* Center - less space */
    text-align: left;
}

.third-column {
    padding-left: 10px;
}

/* Optional: Ensure inputs are consistent */
.column input {
    width: 100%;
    font-size: 12px;
    margin-bottom: 0px;
}

/* Make labels a little smaller for alignment */
.column label {
    display: block;
    margin-bottom: 0px;
    font-size: 13px;
}
.d-flex.align-items-center {
    gap: 4px; /* Reduce space between label and input */
}

.d-flex.align-items-center > div {
    margin-bottom: 0;
    flex: 0 0 auto; /* Prevent stretching */
    padding-right: 4px; /* Small spacing */
}

.d-flex.align-items-center label {
    margin-bottom: 0;
    font-size: 12px; /* Optional: reduce font size */
    white-space: nowrap; /* Keep label on one line */
}

.d-flex.align-items-center input {
    flex: 1; /* Let input take remaining space */
    max-width: 150px; 
    font-size: 13px;
}


/* --------------------------- INVOICE STYLE ----------------------------- */

@media print {
    body * {
        visibility: hidden;
    }
    #print-invoice, #print-invoice * {
        visibility: visible;
    }
    #print-invoice {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
    }
}

/* --------------------------- INVOICE STYLE END ----------------------------- */
    </style>

 <div class="container_box">

 <div class="container">


<h2>Lorry Receipt</h2>

<form method="post" id="bill-form">
    {% csrf_token %}
    <div class="container">
        <div class="top-section">
    <!-- 1Ô∏è‚É£ Consigner Column -->
    <div class="column">
        <!-- Row 1: Series + Bill No -->
        <div class="form-row double" style="width: 154%;">
            <div class="field-pair">
                <label>Series</label>
                <select name="series" id="series" class="form-control" required style="padding: 3px 6px; font-size: 13px; height: 30px;">
                        <option value="">Select series</option>
                        {% for voucher in vouchers %}
                            <option value="{{ voucher.id }}">{{ voucher.series }}</option>
                        {% endfor %}
                    </select>
            </div>
            <div class="field-pair">
                <label>Bill No</label>
                <input type="text" name="entry_number" id="entry_number" class="form-control" readonly required>
            </div>
            <div class="field-pair">
            <label>Date</label>
            <input type="date" id="bill_date" name="bill_date" class="form-control" value="{% now 'Y-m-d' %}" required>
        </div>
        </div>

        <!-- Row 2: Code + Name -->
        <div class="form-row double" style="width: 161%;">
            <div class="field-pair" style="max-width: 190px;">
                <label>Code</label>
                <input type="text" style="max-width: 50% !important;" id="consigner_code" name="consigner_code" class="form-control">
            </div>
            <div class="field-pair" style="max-width: 300px; display: flex; align-items: center;">
                <label style="margin-right: 8px; white-space: nowrap;">Consigner Name</label>
                <input type="text" id="consigner_name" name="consigner_name" class="form-control">
            </div>
        </div>

        <!-- Row 3‚Äì5: Address 1‚Äì3 -->
        <div class="form-row"><label>Address 1</label><input type="text" id="consigner_address1" name="consigner_address1" class="form-control"></div>
        <div class="form-row"><label>Address 2</label><input type="text" id="consigner_address2" name="consigner_address2" class="form-control"></div>
        <div class="form-row"><label>Address 3</label><input type="text" id="consigner_address3" name="consigner_address3" class="form-control"></div>
        <div class="form-row"><label>GST No</label><input type="text" id="consigner_gstno" name="consigner_gstno" class="form-control"></div>
        <div class="form-row"><label>Phone</label><input type="text" id="consigner_phone" name="consigner_phone" class="form-control"></div>
    </div>

    <!-- 2Ô∏è‚É£ Middle Column -->
    <div class="column" style="position: relative; top: 75px;">
        <div class="form-row">
            <label>Payment</label>
            <select id="payment_method" name="payment_method">
                <option value="PAID">PAID</option>
                <option value="TO_PAY">TO PAY</option>
                <option value="CREDIT">CREDIT</option>
            </select>
        </div>

        <div class="form-row">
            <label>Invoice No</label>
            <input type="text" id="invoice_no" name="invoice_no" class="form-control">
        </div>

        <div class="form-row">
            <label>Invoice Date</label>
            <input type="date" id="invoice_date" name="invoice_date" class="form-control">
        </div>

        <div class="form-row">
            <label>Vehicle No</label>
            <input type="text">
        </div>
    </div>

    <!-- 3Ô∏è‚É£ Consignee Column -->
    <div class="column">
        <!-- Row 1: Code + Name -->
        <div class="form-row double" style="transform: translateX(-130px); width: 141%;">
            <div class="field-pair" style="max-width: 190px;">
                <label>Code</label>
                <input type="text" style="max-width: 50% !important;" id="consignee_code" name="consignee_code" class="form-control">
            </div>
            <div class="field-pair" style="max-width: 300px; display: flex; align-items: center;">
                <label style="margin-right: 8px; white-space: nowrap;">Consignee Name</label>
                <input type="text" id="consignee_name" name="consignee_name" class="form-control">
            </div>
        </div>

        <!-- Row 2‚Äì4: Address 1‚Äì3 -->
        <div class="form-row"><label>Address 1</label><input type="text" name="consignee_address1" id="consignee_address1" class="form-control"></div>
        <div class="form-row"><label>Address 2</label><input type="text" name="consignee_address2" id="consignee_address2" class="form-control"></div>
        <div class="form-row"><label>Address 3</label><input type="text" name="consignee_address3" id="consignee_address3" class="form-control"></div>
        <div class="form-row"><label>GST No</label><input type="text" name="consignee_gstno" id="consignee_gstno" class="form-control"></div>
        <div class="form-row"><label>Phone</label><input type="text" name="consignee_phone" id="consignee_phone" class="form-control"></div>
        </div>
    </div>
</div>

        <!-- ?? Table Section -->
<div class="table-container">
        <table id="tripTable" border="1" style="width:100%; border-collapse:collapse; text-align:center;">
            <thead>
                <tr>
                    <th>Sl.no</th>
                    <th>Item Code</th>
                    <th>Commodity/Item</th>
                    <th>Weight</th>
                    <th>Rate</th>
                    <th>Freight</th>
                    <th>Plug</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="slno">1</td>
                    <td><input type="text" name="item_code[]" class="item_code form-control"></td>
                    <td><input type="text" name="commodity[]" class="commodity form-control"></td>
                    <td><input type="number" name="weight[]" class="weight form-control"></td>
                    <td><input type="number" name="rate[]" class="rate form-control"></td>
                    <td><input type="number" name="freight[]" class="freight form-control" readonly></td>
                    <td><input type="text" name="plug[]" class="plug form-control"></td>
                    <td><span class="delete-row" style="cursor:pointer; color:red;"><svg xmlns="http://www.w3.org/2000/svg" height="12" width="12" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ff0000" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/></svg></span></td>
                </tr>
            </tbody>
        </table>
    </div>

        <!-- ?? Expense Details Section -->
        <div class="row mt-4"></div>

<div class="bottom-section"
     style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:10px;">

  <!-- üß± Column 1: Load From / Load To -->
  <div class="column" style="flex:1;min-width:200px;">
    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="load_from" style="width:80px;">Load From</label>
      <select name="load_from" id="load_from"
              class="form-control" style="width:110px;height:28px;" required>
        <option value="">Select</option>
        {% for loc in locations %}
          <option value="{{ loc.name }}">{{ loc.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="d-flex align-items-center">
      <label for="load_to" style="width:80px;">Load To</label>
      <select name="load_to" id="load_to"
              class="form-control" style="width:110px;height:28px;" required>
        <option value="">Select</option>
        {% for loc in locations %}
          <option value="{{ loc.name }}">{{ loc.name }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <!-- üí∞ Column 2: Rate / Freight -->
  <div class="column" style="flex:1;min-width:200px;">
    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="rate" style="width:80px;">Rate</label>
      <input type="number" class="form-control"
             name="rate" id="rate" value="0.00" step="0.01"
             style="width:110px;height:28px;">
    </div>

    <div class="d-flex align-items-center">
      <label for="freight" style="width:80px;">Freight</label>
      <input type="number" class="form-control"
             name="freight" id="freight" value="0.00" step="0.01"
             style="width:110px;height:28px;" readonly>
    </div>
  </div>

  <!-- üíµ Column 3: Hire / Advance / Balance -->
  <div class="column" style="flex:1;min-width:200px;">
    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="hire" style="width:80px;">Hire</label>
      <input type="number" class="form-control"
             name="hire" id="hire" value="0.00" step="0.01"
             style="width:110px;height:28px;">
    </div>

    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="advance_paid" style="width:80px;">Advance</label>
      <input type="number" class="form-control"
             name="advance_paid" id="advance_paid" value="0.00" step="0.01"
             style="width:110px;height:28px;">
    </div>

    <div class="d-flex align-items-center">
      <label for="balance" style="width:80px;">Balance</label>
      <input type="number" class="form-control"
             name="balance" id="balance" value="0.00" step="0.01"
             style="width:110px;height:28px;" readonly>
    </div>
  </div>

  <!-- üìä Column 4: Totals -->
  <div class="column" style="flex:1;min-width:200px;">
    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="net_total" style="width:80px;">Before Tax</label>
      <input type="number" class="form-control"
             name="net_total" id="net_total" value="0.00" step="0.01"
             style="width:110px;height:28px;" readonly>
    </div>

    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="cgst" style="width:80px;">CGST</label>
      <input type="number" class="form-control"
             name="cgst" id="cgst" value="0.00" step="0.01"
             style="width:110px;height:28px;" readonly>
    </div>

    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="sgst" style="width:80px;">SGST</label>
      <input type="number" class="form-control"
             name="sgst" id="sgst" value="0.00" step="0.01"
             style="width:110px;height:28px;" readonly>
    </div>

    <div class="d-flex align-items-center" style="margin-bottom:6px;">
      <label for="igst" style="width:80px;">IGST</label>
      <input type="number" class="form-control"
             name="igst" id="igst" value="0.00" step="0.01"
             style="width:110px;height:28px;" readonly>
    </div>

    <div class="d-flex align-items-center">
      <label for="grand_total" style="width:80px;">Grand Total</label>
      <input type="number" class="form-control"
             name="grand_total" id="grand_total" value="0.00" step="0.01"
             style="width:110px;height:28px;" readonly>
    </div>
  </div>
</div>

         <!-- Buttons -->
         <div class="">
            <div class="col-sm-12 text-end">
                <a href="{% url 'main:index' %}" id="" class="btn btn-danger btn-sm">Cancel</a>
                <button type="submit" id="print-button" class="btn btn-secondary btn-sm print-button" name="action" value="print">Print</button>
                <button type="button" onclick="clearForm()" class="btn btn-info btn-sm" style="margin-top: -45px;">Clear</button>
                <button type="submit" id="" class="btn btn-success btn-sm" name="action" value="save">Save</button>
            </div>
    </div>
</form>


</div>
</div>






<script src="{% static 'vendor/jquery-3.2.1.min.js' %}"></script>
<!-- Then jQuery UI -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<!-- Then jQuery UI -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<!-- Bootstrap JS-->
<script src="{% static 'vendor/bootstrap-4.1/popper.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap-4.1/bootstrap.min.js' %}"></script>
<!-- Vendor JS       -->
<script src="{% static 'vendor/slick/slick.min.js' %}">
</script>
<script src="{% static 'vendor/wow/wow.min.js' %}"></script>
<script src="{% static 'vendor/animsition/animsition.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap-progressbar/bootstrap-progressbar.min.js' %}">
</script>
<script src="{% static 'vendor/counter-up/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'vendor/counter-up/jquery.counterup.min.js' %}">
</script>
<script src="{% static 'vendor/circle-progress/circle-progress.min.js' %}"></script>
<script src="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.js' %}"></script>
<script src="{% static 'vendor/chartjs/Chart.bundle.min.js' %}"></script>
<script src="{% static 'vendor/select2/select2.min.js' %}">
</script>

<!-- Main JS-->
<script src="{% static 'js/main.js' %}"></script>
<script>
    document.getElementById('series').addEventListener('change', function () {
        const seriesId = this.value;
        if (seriesId) {
            fetch(`/get_serial_number_lr/?series_id=${seriesId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.serial_no !== undefined) {
                        $('input[name="entry_number"]').val(data.serial_no);
                    } else {
                        document.getElementById('entry_number').value = '';
                    }
                })
                .catch(error => {
                    console.error('Error fetching serial number:', error);
                    document.getElementById('entry_number').value = '';
                });
        } else {
            document.getElementById('entry_number').value = '';
        }
    });
</script>
<script>
    $(document).ready(function() {
        $('#consigner_name, #consignee_name').select2({
            allowClear: true,
            width: 'style'
        });
    });
</script>
<script>
function setupAutocomplete(prefix) {
    $(`#${prefix}_name`).autocomplete({
        source: '/ajax/autocomplete-customers/',   // ‚úÖ fixed URL
        minLength: 1,
        select: function(event, ui) {
            $(`#${prefix}_name`).val(ui.item.value);
            $(`#${prefix}_address1`).val(ui.item.address || '');
            $(`#${prefix}_address2`).val(ui.item.address2 || '');
            $(`#${prefix}_address3`).val(ui.item.address3 || '');
            $(`#${prefix}_gstno`).val(ui.item.gstno || '');
            $(`#${prefix}_phone`).val(ui.item.mobile || '');
            $(`#${prefix}_code`).val(ui.item.account_code || '');
            return false;
        }
    });
}

$(document).ready(function() {
    setupAutocomplete("consigner");
    setupAutocomplete("consignee");
});
</script>

<script>
$(document).ready(function() {

    // ‚ûï Add new row
    function addNewRow() {
        const table = $("#tripTable tbody");
        const rowCount = table.find("tr").length + 1;

        const newRow = `
            <tr>
                <td class="slno">${rowCount}</td>
                <td><input type="text" name="item_code[]" class="item_code form-control"></td>
                <td><input type="text" name="commodity[]" class="commodity form-control"></td>
                <td><input type="number" name="weight[]" class="weight form-control"></td>
                <td><input type="number" name="rate[]" class="rate form-control"></td>
                <td><input type="number" name="freight[]" class="freight form-control" readonly></td>
                <td><input type="text" name="plug[]" class="plug form-control"></td>
                <td><span class="delete-row" style="cursor:pointer; color:red;"><svg xmlns="http://www.w3.org/2000/svg" height="12" width="12" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ff0000" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/></svg></span></td>
            </tr>`;
        table.append(newRow);
    }

    // üî¢ Update serial numbers
    function updateSerialNumbers() {
        $("#tripTable tbody tr").each(function(index) {
            $(this).find(".slno").text(index + 1);
        });
    }

    // üí∞ Auto-calculate Freight
    $(document).on("input", ".rate, .weight", function() {
        const row = $(this).closest("tr");
        const rate = parseFloat(row.find(".rate").val()) || 0;
        const weight = parseFloat(row.find(".weight").val()) || 0;
        const freight = rate * weight;
        row.find(".freight").val(freight.toFixed(2));
    });

    // ‚ùå Delete row with check
    $(document).on("click", ".delete-row", function() {
        const rowCount = $("#tripTable tbody tr").length;
        if (rowCount <= 1) {
            Swal.fire({
                icon: "warning",
                title: "At least one row must remain!",
                confirmButtonColor: "#d33",
                confirmButtonText: "OK"
            });
            return;
        }
        $(this).closest("tr").remove();
        updateSerialNumbers();
    });

    // ‚èé Add new row on Enter in rate or freight
    $(document).on("keydown", ".rate, .freight", function(e) {
        if (e.key === "Enter") {
            e.preventDefault();
            addNewRow();
        }
    });

    // üñ±Ô∏è Double-click to add new row
    $("#tripTable").on("dblclick", function() {
        addNewRow();
    });

});
</script>
{% endblock %}
