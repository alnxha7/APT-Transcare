{% extends "base.html" %}
{% load static %}
{% block content %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorry Receipt</title>

    <link href="{% static 'css/font-face.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/font-awesome-5/css/fontawesome-all.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="{% static 'vendor/bootstrap-4.1/bootstrap.min.css' %}" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="{% static 'vendor/animsition/animsition.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css' %}" rel="stylesheet"
          media="all">
    <link href="{% static 'vendor/wow/animate.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/css-hamburgers/hamburgers.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/slick/slick.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/select2/select2.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.css' %}" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="{% static 'css/theme.css' %}" rel="stylesheet" media="all">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
    @media print {
        body {
            width: 210mm;
            height: 297mm;
            margin: 0;
            padding: 0;
        }
        table {
            width: 100%;
        }
        #print-button {
            display: none;
        }
    }
        .form-control {
        padding: 0px 8px;
        font-size: 14px;
    }
    .mb-3, .mb-2 {
        margin-bottom: 8px !important;
        align-items: center;
    }
     body {
            font-family: Public Sans, sans-serif;
            background-color: #f4f4f4;

            margin: 0;
            padding: 0;
            font-size: 14px;
            align-items: center;
            color:black;
            overflow-x: hidden;

        }
         .logo p {
        color:white;
        }
        .container_box {
            background-color:antiquewhite;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border: 2px solid rgb(43, 114, 227);
            margin-left:20px;
            margin-top: 25px;
        }


        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            padding-top: 7px;
            margin-bottom: 5px;
        }

        
        input, select {
            width: 100%;
            font-size: 10px;
        }
        select {
        background:white;
        

        }
        table {
            background:white;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom:20px;
        }
        .table_input{
            border:none;
        }
        th {
            border: 1px solid black;
            background:#f2f2f2;
            padding:0px;
            text-align: center;
            font-size: 12px;
        }
        button {
            padding: 10px;
            background: #28a745;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #218838;
        }
        .btn {
            margin-top: -10px;
            display: inline-block;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 4px;
            color: white;
            margin-right:10px;
            margin-bottom:20px;
        }

        .btn-info{
            margin-top: -25px;
            display: inline-block;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 4px;
            color: white;
            margin-right:10px;
            margin-bottom:-15px; 
        }

        .save-btn { background-color: #28a745; }
        .back-btn { background-color: #007bff; }

        .input-right {
            text-align: right;
        }
    @media only screen and (max-width: 600px) {
  .container_box  {
    width: 90%;
  }
}
    label {
        font-weight: 500;
        width: 90px;
        font-size: 12px;
    }
    .form-group-row {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }
    .form-group-row label {
        min-width: 120px;
        margin-right: 8px;
        margin-bottom: 0;
    }
    /* .table-container {
            margin-top: 20px;
            overflow-x: auto;
        } */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th {
            border: 1px solid #999;
            padding: 0px;
            text-align: center;
        }
        td {
            border: 1px solid #999;
            padding: -4px;
            text-align: center;
            font-size: 11px;
        }
        th {
            background-color: #f2f2f2;
        }
        input[type="text"], input[type="number"] {
            /* width: 100%; */
            padding: -5px;
            box-sizing: border-box;
        }
        .btn-delete {
            color: white;
            border: none;
            padding: 0px 5px;
            cursor: pointer;
        }
        .btn-delete:hover {
            background-color: #c0392b;
        }
        .table_data {
            font-size: 12px;
            padding: 2px 4px;
            text-align: center;
            width: 70px; /* set a fixed width */
            max-width: 80px; /* prevent stretching */
            box-sizing: border-box;
        }
.top-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 25px;
}

/* Column styling */
.column {
    flex: 1;
    min-width: 300px;
}

.column h4 {
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 10px;
    text-decoration: underline;
}

/* Single field row */
.form-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
    width: 100%;
    gap: 8px;
}

.form-row label {
    flex: 0 0 68px;
    text-align: left;
    font-size: 13px;
    margin: 0;
    white-space: nowrap;
}

.form-row input,
.form-row select {
    flex: 1;
    padding: 2px 3px;
    font-size: 13px;
    border: 1px solid #ccc;
}

/* Double fields (2 per row) */
.form-row.double {
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.field-pair {
    display: flex;
    align-items: center;
    flex: 1;
    gap: 6px;
}

.field-pair label {
    flex: 0 0 3px;
    text-align: left;
    font-size: 13px;
}

.field-pair input,
.field-pair select {
    flex: 1.5;
}

/* Bottom OK button */
.bottom-buttons {
    width: 100%;
    text-align: center;
    margin-top: 12px;
}

.bottom-buttons button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 6px 14px;
    font-size: 13px;
    border-radius: 4px;
    cursor: pointer;
}

.bottom-buttons button:hover {
    background-color: #0056b3;
}

/* Responsive */
@media (max-width: 992px) {
    .top-section {
        flex-direction: column;
    }
}

.form-group {
    margin: 0px;
}

    .bottom-section {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.column {
    padding: 2px;
    border-radius: 6px;
   /* box-shadow: 0 0 4px rgba(0, 0, 0, 0.1);*/
}

/* Widths to control layout */
/* .first-column {
    flex: 1; 
} */

.second-column {
    flex: 0.5; /* Center - less space */
    text-align: left;
}

.third-column {
    padding-left: 10px;
}

/* Optional: Ensure inputs are consistent */
.column input {
    width: 100%;
    font-size: 12px;
    margin-bottom: 0px;
}

/* Make labels a little smaller for alignment */
.column label {
    display: block;
    margin-bottom: 0px;
    font-size: 13px;
}
.d-flex.align-items-center {
    gap: 4px; /* Reduce space between label and input */
}

.d-flex.align-items-center > div {
    margin-bottom: 0;
    flex: 0 0 auto; /* Prevent stretching */
    padding-right: 4px; /* Small spacing */
}

.d-flex.align-items-center label {
    margin-bottom: 0;
    font-size: 12px; /* Optional: reduce font size */
    white-space: nowrap; /* Keep label on one line */
}

.d-flex.align-items-center input {
    flex: 1; /* Let input take remaining space */
    max-width: 150px; 
    font-size: 13px;
}
 </style>

<!-- /* --------------------------- INVOICE STYLE ----------------------------- */ -->

<style>
@media print {
  @page {
    size: landscape;
    margin: 10mm;
  }
  #print-header {
    display: block !important;
  }
  body *:not(#print-header):not(#print-header *) {
    visibility: hidden;
  }
  #print-header {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
  }
}
</style>

<!-- /* --------------------------- INVOICE STYLE END ----------------------------- */ -->

 <div class="container_box">

 <div class="container">


<h2>Lorry Receipt</h2>

<form method="post" id="bill-form">
    {% csrf_token %}
    <div class="container">
        <div class="top-section">
    <!-- 1ï¸âƒ£ Consigner Column -->
    <div class="column">
        <!-- Row 1: Series + Bill No -->
        <div class="form-row double" style="width: 154%;">
            <div class="field-pair">
                <label>Series</label>
                <select name="series" id="series" class="form-control" required style="padding: 3px 6px; font-size: 13px; height: 30px;" {% if lr.series %} disabled {% endif %}>
                        <option value="">Select series</option>
                        {% for voucher in vouchers %}
                            <option value="{{ voucher.id }}" {% if lr.series.id == voucher.id %} selected {% endif %}>{{ voucher.series }}</option>
                        {% endfor %}
                    </select>
            </div>
            <div class="field-pair">
                <label>Lr No</label>
                <input type="text" name="entry_number" id="entry_number" class="form-control" value="{{ lr.lr_no }}" readonly required>
            </div>
            <div class="field-pair">
            <label>Date</label>
            <input type="date" id="bill_date" name="bill_date" 
            class="form-control" value="{% if lr.lr_date %}{{ lr.lr_date|date:'Y-m-d' }}{% else %}{% now 'Y-m-d' %}{% endif %}" required>
        </div>
        </div>

        <!-- Row 2: Code + Name -->
        <div class="form-row double" style="width: 171%;">
            <div class="field-pair" style="max-width: 190px;">
                <label>Code</label>
                <input type="text" style="max-width: 50% !important;" id="consigner_code" name="consigner_code" class="form-control" value="{{ lr.consigner_code }}" required>
            </div>
            <div class="field-pair" style="max-width: 335px; display: flex; align-items: center;">
                <label style="margin-right: 8px; white-space: nowrap;">Consigner Name</label>
                <input type="text" id="consigner_name" name="consigner_name" class="form-control" value="{{ lr.consigner_name }}" required>
            </div>
        </div>

        <!-- Row 3â€“5: Address 1â€“3 -->
        <div class="form-row"><label>Address 1</label><input type="text" id="consigner_address1" name="consigner_address1" class="form-control" value="{{ lr.consigner_account.address1 }}"></div>
        <div class="form-row"><label>Address 2</label><input type="text" id="consigner_address2" name="consigner_address2" class="form-control" value="{{ lr.consigner_account.address2 }}"></div>
        <div class="form-row"><label>Address 3</label><input type="text" id="consigner_address3" name="consigner_address3" class="form-control" value="{{ lr.consigner_account.address3 }}"></div>
        <div class="form-row"><label>GST No</label><input type="text" id="consigner_gstno" name="consigner_gstno" class="form-control" value="{{ lr.consigner_account.gstno }}"></div>
        <div class="form-row"><label>Phone</label><input type="text" id="consigner_phone" name="consigner_phone" class="form-control" value="{{ lr.consigner_account.mobile }}"></div>
    </div>

    <!-- 2ï¸âƒ£ Middle Column -->
    <div class="column" style="position: relative; top: 75px;">
        <div class="form-row">
            <label>Payment</label>
            <select id="payment_method" name="payment_method">
                <option value="PAID" {% if lr.payment == "PAID" %} selected {% endif %}>PAID</option>
                <option value="TO_PAY" {% if lr.payment == "TO_PAY" %} selected {% endif %}>TO PAY</option>
                <option value="CREDIT" {% if lr.payment == "CREDIT" %} selected {% endif %}>CREDIT</option>
            </select>
        </div>

        <div class="form-row">
            <label>Invoice No</label>
            <input type="text" id="invoice_no" name="invoice_no" class="form-control" value="{{ lr.invoice_no }}" required>
        </div>

        <div class="form-row">
            <label>Invoice Date</label>
            <input type="date" id="invoice_date" name="invoice_date" 
                class="form-control" value="{% if lr.invoice_date %}{{ lr.invoice_date|date:'Y-m-d' }}{% else %}{% now 'Y-m-d' %}{% endif %}" required>
        </div>

        <div class="form-row">
            <label>Vehicle No</label>
            <input type="text" id="vehicle_no" name="vehicle_no" class="form-control" value="{{ lr.vehicle_no }}" required>
        </div>
    </div>

    <!-- 3ï¸âƒ£ Consignee Column -->
    <div class="column">
        <!-- Row 1: Code + Name -->
        <div class="form-row double" style="transform: translateX(-170px); width: 154%;">
            <div class="field-pair" style="max-width: 170px;">
                <label>Code</label>
                <input type="text" style="max-width: 50% !important;" id="consignee_code" name="consignee_code" value="{{ lr.consignee_code }}" class="form-control" required>
            </div>
            <div class="field-pair" style="max-width: 300px; display: flex; align-items: center;">
                <label style="margin-right: 8px; white-space: nowrap;">Consignee Name</label>
                <input type="text" id="consignee_name" name="consignee_name" class="form-control" value="{{ lr.consignee_name }}" required>
            </div>
        </div>

        <!-- Row 2â€“4: Address 1â€“3 -->
        <div class="form-row"><label>Address 1</label><input type="text" name="consignee_address1" id="consignee_address1" class="form-control" value="{{ lr.consignee_account.address1 }}"></div>
        <div class="form-row"><label>Address 2</label><input type="text" name="consignee_address2" id="consignee_address2" class="form-control" value="{{ lr.consignee_account.address2 }}"></div>
        <div class="form-row"><label>Address 3</label><input type="text" name="consignee_address3" id="consignee_address3" class="form-control" value="{{ lr.consignee_account.address3 }}"></div>
        <div class="form-row"><label>GST No</label><input type="text" name="consignee_gstno" id="consignee_gstno" class="form-control" value="{{ lr.consignee_account.gstno }}"></div>
        <div class="form-row"><label>Phone</label><input type="text" name="consignee_phone" id="consignee_phone" class="form-control" value="{{ lr.consignee_account.mobile }}"></div>
        </div>
    </div>
</div>

        <!-- ?? Table Section -->
<div class="table-container">
        <table id="tripTable" border="1" style="width:100%; border-collapse:collapse; text-align:center;">
            <thead>
                <tr>
                    <th>Sl.no</th>
                    <th style="width: 7%;">Item Code</th>
                    <th style="width: 35%;">Commodity/Item</th>
                    <th>Weight</th>
                    <th>Rate</th>
                    <th>Freight</th>
                    <th>Pkg</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% if lr_items %}
                    {% for item in lr_items %}
                    <tr>
                        <td class="slno">{{ forloop.counter }}</td>
                        <td><input type="text" name="item_code[]" class="item_code form-control" value="{{ item.item_code }}"></td>
                        <td><input type="text" name="commodity[]" class="commodity form-control" value="{{ item.item }}"></td>
                        <td><input type="number" name="weight[]" class="weight form-control" value="{{ item.weight }}"></td>
                        <td><input type="number" name="rate[]" class="rate form-control" value="{{ item.rate }}"></td>
                        <td><input type="number" name="freight[]" class="freight form-control" value="{{ item.freight }}" readonly></td>
                        <td><input type="text" name="pkg[]" class="pkg form-control" value="{{ item.pkg }}"></td>
                        <td><span class="delete-row" style="cursor:pointer; color:red;">
                            <svg xmlns="http://www.w3.org/2000/svg" height="12" width="12" viewBox="0 0 640 640">
                                <path fill="#ff0000" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/>
                            </svg>
                        </span></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td class="slno">1</td>
                        <td><input type="text" name="item_code[]" class="item_code form-control"></td>
                        <td><input type="text" name="commodity[]" class="commodity form-control"></td>
                        <td><input type="number" name="weight[]" class="weight form-control"></td>
                        <td><input type="number" name="rate[]" class="rate form-control"></td>
                        <td><input type="number" name="freight[]" class="freight form-control" readonly></td>
                        <td><input type="text" name="pkg[]" class="pkg form-control"></td>
                        <td><span class="delete-row" style="cursor:pointer; color:red;">
                            <svg xmlns="http://www.w3.org/2000/svg" height="12" width="12" viewBox="0 0 640 640">
                                <path fill="#ff0000" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/>
                            </svg>
                        </span></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

        <!-- ?? Expense Details Section -->
        <div class="row mt-4"></div>

<div class="bottom-section"
     style="display:flex;justify-content:space-between;align-items:flex-end;gap:20px;flex-wrap:wrap;margin-top:15px;">

  <!-- ðŸ§± Column 1: Load From / Load To -->
  <div class="column" style="flex:1;min-width:250px;">
    <div class="d-flex align-items-center" style="margin-bottom:8px;">
      <label for="load_from" style="width:90px;">Load From</label>
      <select name="load_from" id="load_from"
              class="form-control"
              style="width:230px;height:25px;padding:0 4px;" required>
        <option value="">Select</option>
        {% for loc in locations %}
          <option value="{{ loc.location }}" {% if loc.location == lr.load_from %}selected{% endif %}>{{ loc.location }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="d-flex align-items-center">
      <label for="load_to" style="width:90px;">Load To</label>
      <select name="load_to" id="load_to"
              class="form-control"
              style="width:230px;height:25px;padding:0 4px;" required>
        <option value="">Select</option>
        {% for loc in locations %}
          <option value="{{ loc.location }}" {% if loc.location == lr.load_to %}selected{% endif %}>{{ loc.location }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="totals-column"
       style="display:flex;flex-direction:column;align-items:flex-end;gap:8px;min-width:220px;">
    <div style="display:flex;align-items:center;gap:10px;">
      <label for="total_charges" style="width:110px;text-align:right;">Total Charges</label>
      <input type="number" class="form-control"
             name="total_charges" id="total_charges"
             value="{% if lr.total_charges %}{{ lr.total_charges }}{% else %}0.00{% endif %}"
             step="0.01"
             style="width:100px;height:25px;text-align:right;" readonly>
    </div>

    <div style="display:flex;align-items:center;gap:10px;">
      <label for="grand_total" style="width:110px;text-align:right;">Grand Total</label>
      <input type="number" class="form-control"
             name="grand_total" id="grand_total"
             value="{% if lr.grand_total %}{{ lr.grand_total}}{% else %}0.00{% endif %}"
             step="0.01"
             style="width:100px;height:25px;text-align:right;" readonly>
    </div>
  </div>

</div>

<!-- ðŸ”¹ Buttons Section -->
<div class="text-end" style="margin-top:30px;">
  <a href="{% url 'main:index' %}" class="btn btn-danger btn-sm">Cancel</a>
  <button type="submit" class="btn btn-primary btn-sm print-button" name="action" value="print">Print</button>
  <button type="submit" class="btn btn-success btn-sm" name="action" value="save">Save</button>
</div>
</form>


</div>
</div>








<!-- --------------------------------------------------- INVOICE ----------------------------------------------------->

<div id="print-header" style="display: none; width:100%; padding:10px 30px; box-sizing:border-box; background-color: white;">

  <div style="display:flex; justify-content:space-between; align-items:flex-start; width:100%; position:relative; background: white;">
    <!-- Left side -->
    <div style="text-align:left; flex:1;">
      <img src="{% static 'images/icon/bullet_logo.png' %}" alt="Company Logo" style="width:130px; height:auto; margin-bottom:6px;">
      <div style="font-weight:bold; font-size:18px;">{{ lr.company.name }}</div>
      <div style="font-size:13px;">Phone: {{ lr.company.phoneno }} | Mobile: {{ lr.company.mobile }}</div>
      <div style="font-size:13px;">{{ lr.company.address1 }}</div>
      <div style="font-size:13px;">{{ lr.company.address2 }}</div>
      <div style="font-size:13px;">{{ lr.company.address3 }}</div>
      <div style="font-size:13px;">GST No: {{ lr.company.gst }}</div>
    </div>

    <!-- Right side -->
    <div style="text-align:right; flex:1;">
      <div style="font-size:14px; margin-bottom:4px;">LR No: <strong>{{ lr.lr_no }}</strong></div>
      <div style="font-size:14px;">Date: <strong>{{ lr.lr_date }}</strong></div>
      <div style="margin-top:12px; font-size:13px;">
        <div><strong>Head Office:</strong></div>
        <div>Opp. Head Post Office, KATTAPPANA, IDUKKI - 685 508</div>
        <div>Ph: 04868 272903, Mob: 9061781004</div>
      </div>
    </div>

    <!-- Center heading -->
    <div style="
      position:absolute;
      top:25%;
      left:50%;
      transform:translate(-50%, -25%);
      text-align:center;
      width:60%;
    ">
      <div style="font-weight:bold; font-size:20px; text-decoration:underline;">
        GOODS CONSIGNMENT NOTE - B to B
      </div>
      <div style="font-style:italic; font-size:13px; margin-top:4px;">
        RCM Method (Reverse Charge Mechanism)
      </div>
    </div>
  </div>

  <div style="display:flex; justify-content:space-between; width:100%;">
    
    <!-- Left: Consigner -->
    <div style="flex:1; border:1px solid #000; padding:8px;">
      <div style="font-weight:bold; text-align:center; margin-bottom:6px;"></div>
      <div><strong>Consigner:</strong> {{ lr.consigner_name }}</div>
    </div>

    <!-- Right: Consignee -->
    <div style="flex:1; border:1px solid #000; padding:8px;">
      <div style="font-weight:bold; text-align:center; margin-bottom:6px;"></div>
      <div><strong>Consignee:</strong> {{ lr.consignee_name }}</div>
    </div>
  </div>

  <div style="display:flex; justify-content:space-between; width:100%;">
    
    <!-- Left: Consigner -->
    <div style="flex:1; border:1px solid #000; padding:8px;">
      <div style="font-weight:bold; text-align:center; margin-bottom:6px;"></div>
      <div><strong>From:</strong> {{ lr.load_from }}</div>
    </div>

    <!-- Right: Consignee -->
    <div style="flex:1; border:1px solid #000; padding:8px;">
      <div style="font-weight:bold; text-align:center; margin-bottom:6px;"></div>
      <div><strong>To:</strong> {{ lr.load_to }}</div>
    </div>
  </div>

    <table border="1" style="width:100%; border-collapse:collapse; text-align:center; font-size:13px;">
    <thead style="background:#f2f2f2;">
      <tr>
        <th style="width:4%;">Sl.No</th>
        <th style="width:10%;">Item Code</th>
        <th style="width:40%;">Commodity / Item</th>
        <th style="width:10%;">Weight</th>
        <th style="width:10%;">Rate</th>
        <th style="width:10%;">Freight</th>
        <th style="width:10%;">Pkg</th>
      </tr>
    </thead>
    <tbody>
      {% if lr_items %}
        {% for item in lr_items %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ item.item_code }}</td>
          <td style="text-align:left;">{{ item.item }}</td>
          <td>{{ item.weight }}</td>
          <td>{{ item.rate }}</td>
          <td>{{ item.freight }}</td>
          <td>{{ item.pkg }}</td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="7" style="text-align:center;">No items found</td>
        </tr>
      {% endif %}
    </tbody>
  </table>

    <div style="display:flex; justify-content:flex-end; padding:0px 10px 10px 0;">
  <div class="totals-column"
       style="display:flex; flex-direction:column; align-items:flex-end; gap:6px; min-width:260px; font-size:12.5px;">
    
    <div style="display:flex; align-items:center; justify-content:flex-end; width:100%;">
      <label style="width:120px; text-align:right; font-weight:600; margin-right:8px;">Total Charges</label>
      <div style="width:50px;">
        {{ lr.total_charges }}
      </div>
    </div>

    <div style="display:flex; align-items:center; justify-content:flex-end; width:100%;">
      <label style="width:120px; text-align:right; font-weight:600; margin-right:8px;">Grand Total</label>
      <div style="width:110px; text-align:right; border:1px solid #000; padding:4px 8px; background-color: #93f593; color: #000;">
        {{ lr.grand_total }}
      </div>
    </div>
  </div>
</div>

    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px; width:100%; font-size: 9px;">

    <!-- Left Section: Terms & Conditions -->
    <div style="flex:1; border:1px solid #000; padding:6px;">
      <div style="font-weight:bold; text-align:center; text-decoration:underline; margin-bottom:4px;">
        TERMS & CONDITIONS
      </div>
        <li>1. This is a non-negotiable note.
        All consignments accepted for dispatch are carried entirely at owners risk.
        The company is not responsible for leakage of liquid contents booked.
        Any requirement of Proof of Delivery (POD) should be intimated within 3 months from the date of booking.
        We carry under RCM Method (Reverse Charge Mechanism) Act. (Regretted as Goods Transporting Agency).
        Our liability on loss / damage / delay of this consignment is limited to Rs. 100/- only.
        Subject to Kattappana Jurisdiction.</li>
    </div>

    <!-- Middle Section -->
    <div style="flex:1; border:1px solid #000; padding:6px; text-align:justify;">
      <p style="margin:0; line-height:1.4;">
        I clearly understand and do hereby agree to abide by the terms & conditions printed overleaf and also declare that this consignment does not contain personal mail, currency notes, jewellery, or any item that is banned by the authorities.
      </p>

      <div style="text-align:right; margin-top:25px; font-weight:bold;">
        Consignerâ€™s Signature
      </div>
    </div>

    <!-- Right Section -->
    <div style="flex:0.7; border:1px solid #000; padding:6px;">
      <div style="font-weight:bold; text-align:center; text-decoration:underline; margin-bottom:4px;">
        RECEIVED THE CONSIGNMENT IN GOOD CONDITION
      </div>
      <div style="line-height:1.6;">
        <div><strong>Name:</strong> __________________________</div>
        <div><strong>Stamp:</strong> _________________________</div>
        <div><strong>Phone:</strong> _________________________</div>
        <div><strong>Date:</strong> __________________________</div>
        <div><strong>Time:</strong> __________________________</div>
        <div style="margin-top:10px;"><strong>Signature:</strong> __________________</div>
      </div>
    </div>
  </div>

</div>


<!-- --------------------------------------------------- INVOICE END ----------------------------------------------------->







<script src="{% static 'vendor/jquery-3.2.1.min.js' %}"></script>
<!-- Then jQuery UI -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<!-- Then jQuery UI -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<!-- Bootstrap JS-->
<script src="{% static 'vendor/bootstrap-4.1/popper.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap-4.1/bootstrap.min.js' %}"></script>
<!-- Vendor JS       -->
<script src="{% static 'vendor/slick/slick.min.js' %}">
</script>
<script src="{% static 'vendor/wow/wow.min.js' %}"></script>
<script src="{% static 'vendor/animsition/animsition.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap-progressbar/bootstrap-progressbar.min.js' %}">
</script>
<script src="{% static 'vendor/counter-up/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'vendor/counter-up/jquery.counterup.min.js' %}">
</script>
<script src="{% static 'vendor/circle-progress/circle-progress.min.js' %}"></script>
<script src="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.js' %}"></script>
<script src="{% static 'vendor/chartjs/Chart.bundle.min.js' %}"></script>
<script src="{% static 'vendor/select2/select2.min.js' %}">
</script>

<!-- Main JS-->
<script src="{% static 'js/main.js' %}"></script>

{% if print %}
<script>
    Swal.fire({
        icon: 'success',
        title: 'Success',
        text: 'LR Saved Successfully',
        confirmButtonText: 'Print Invoice'
    }).then((result) => {
        if (result.isConfirmed) {
            printInvoice();  
        }
    });
</script>
{% elif success %}
<script>
    Swal.fire({
        icon: 'success',
        title: 'Success',
        text: 'LR Saved Successfully',
        confirmButtonText: 'OK',
    });
</script>
{% elif error %}
<script>
    Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Error Saving the LR....Please Try Again.....!!! {{error|escapejs}}',
        confirmButtonText: 'OK'
    });
</script>
{% endif %}
<script>
    document.getElementById('series').addEventListener('change', function () {
        const seriesId = this.value;
        if (seriesId) {
            fetch(`/get_serial_number_lr/?series_id=${seriesId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.serial_no !== undefined) {
                        $('input[name="entry_number"]').val(data.serial_no);
                    } else {
                        document.getElementById('entry_number').value = '';
                    }
                })
                .catch(error => {
                    console.error('Error fetching serial number:', error);
                    document.getElementById('entry_number').value = '';
                });
        } else {
            document.getElementById('entry_number').value = '';
        }
    });
</script>
<script>
    $(document).ready(function() {
        $('#consigner_name, #consignee_name').select2({
            allowClear: true,
            width: 'style'
        });
    });
</script>
<script>
function setupAutocomplete(prefix) {
    $(`#${prefix}_name`).autocomplete({
        source: '/ajax/autocomplete-customers/', 
        minLength: 1,
        select: function(event, ui) {
            $(`#${prefix}_name`).val(ui.item.value);
            $(`#${prefix}_address1`).val(ui.item.address || '');
            $(`#${prefix}_address2`).val(ui.item.address2 || '');
            $(`#${prefix}_address3`).val(ui.item.address3 || '');
            $(`#${prefix}_gstno`).val(ui.item.gstno || '');
            $(`#${prefix}_phone`).val(ui.item.mobile || '');
            $(`#${prefix}_code`).val(ui.item.account_code || '');
            return false;
        }
    });
}

$(document).ready(function() {
    setupAutocomplete("consigner");
    setupAutocomplete("consignee");
});
</script>

<script>
$(document).ready(function() {

    // ðŸ”¹ Function to calculate total freight and update totals
    function updateTotals() {
        let total = 0;

        $("#tripTable tbody tr").each(function() {
            const freight = parseFloat($(this).find(".freight").val()) || 0;
            total += freight;
        });

        $("#total_charges").val(total.toFixed(2));
        $("#grand_total").val(total.toFixed(2)); // you can later modify this if you add taxes/discounts
    }

    // ðŸ”¹ Function to add new row
    function addNewRow() {
        const table = $("#tripTable tbody");
        const rowCount = table.find("tr").length + 1;

        const newRow = `
            <tr>
                <td class="slno">${rowCount}</td>
                <td><input type="text" name="item_code[]" class="item_code form-control"></td>
                <td><input type="text" name="commodity[]" class="commodity form-control"></td>
                <td><input type="number" name="weight[]" class="weight form-control"></td>
                <td><input type="number" name="rate[]" class="rate form-control"></td>
                <td><input type="number" name="freight[]" class="freight form-control" readonly></td>
                <td><input type="text" name="pkg[]" class="plug form-control"></td>
                <td><span class="delete-row" style="cursor:pointer; color:red;">
                    <svg xmlns="http://www.w3.org/2000/svg" height="12" width="12" viewBox="0 0 640 640">
                        <path fill="#ff0000" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/>
                    </svg>
                </span></td>
            </tr>`;
        table.append(newRow);
        updateSerialNumbers();
    }

    // ðŸ”¹ Update serial numbers after add/remove
    function updateSerialNumbers() {
        $("#tripTable tbody tr").each(function(index) {
            $(this).find(".slno").text(index + 1);
        });
    }

    // ðŸ”¹ Recalculate freight and totals on rate/weight input
    $(document).on("input", ".rate, .weight", function() {
        const row = $(this).closest("tr");
        const rate = parseFloat(row.find(".rate").val()) || 0;
        const weight = parseFloat(row.find(".weight").val()) || 0;
        const freight = rate * weight;
        row.find(".freight").val(freight.toFixed(2));

        updateTotals(); // ðŸ‘ˆ Update total every time a value changes
    });

    // ðŸ”¹ Delete a row
    $(document).on("click", ".delete-row", function() {
        const rowCount = $("#tripTable tbody tr").length;
        if (rowCount <= 1) {
            Swal.fire({
                icon: "warning",
                title: "At least one row must remain!",
                confirmButtonColor: "#d33",
                confirmButtonText: "OK"
            });
            return;
        }
        $(this).closest("tr").remove();
        updateSerialNumbers();
        updateTotals(); // ðŸ‘ˆ Update totals after deleting a row
    });

    // ðŸ”¹ Add row on Enter key in rate/freight fields
    $(document).on("keydown", ".rate, .freight", function(e) {
        if (e.key === "Enter") {
            e.preventDefault();
            addNewRow();
        }
    });

    // ðŸ”¹ Add new row on table double-click
    $("#tripTable").on("dblclick", function() {
        addNewRow();
    });

});
</script>

<script>
$(document).on('input', '.item_code, .commodity', function() {
    let input = $(this);
    let query = input.val().trim();
    let row = input.closest('tr');

    $('.suggestion-box').remove();
    if (query.length < 1) return; 
    $.ajax({
        url: '/ajax/item-search/',
        data: { q: query },
        dataType: 'json',
        success: function(data) {
            $('.suggestion-box').remove();

            if (data.length === 0) return;
            let suggestionBox = $('<div class="suggestion-box"></div>');
            suggestionBox.css({
                position: 'absolute',
                background: '#fff',
                border: '1px solid #ccc',
                'z-index': 1000,
                'max-height': '150px',
                'overflow-y': 'auto',
                width: input.outerWidth()
            });

            $.each(data, function(i, item) {
                let option = $('<div class="suggestion-item"></div>').text(item.name + " (" + item.item_code + ")");
                option.css({ padding: '0px', cursor: 'pointer', fontSize: '12px', borderBottom: '1px solid #7b7878' });

                option.on('click', function() {
                    row.find('.commodity').val(item.name);
                    row.find('.item_code').val(item.item_code);
                    $('.suggestion-box').remove();
                });

                suggestionBox.append(option);
            });

            $('body').append(suggestionBox);

            let offset = input.offset();
            suggestionBox.css({
                top: offset.top + input.outerHeight(),
                left: offset.left
            });
        }
    });
});

$(document).on('click', function(e) {
    if (!$(e.target).closest('.suggestion-box, .item_code, .commodity').length) {
        $('.suggestion-box').remove();
    }
});
</script>
{% if lr.id %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll('input, textarea').forEach(el => {
    const insideTable = el.closest('#tripTable'); 
    if (!insideTable && !['button', 'submit'].includes(el.type)) {
      el.setAttribute('readonly', true);
    }
  });
});
</script>
{% endif %}

<script>
function printInvoice() {
    const printContents = document.getElementById("print-header").innerHTML;
    const printWindow = window.open('', '', 'width=900,height=650');
    printWindow.document.write(`
        <html>
        <head>
            <title>Invoice</title>
            <style>
                @media print {
                    body { -webkit-print-color-adjust: exact; }
                    table, th, td { border-collapse: collapse; }
                    th, td { border: 1px solid black; padding: 4px; }
                }
            </style>
        </head>
        <body>${printContents}</body>
        </html>
    `);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
}
</script>
{% endblock %}
